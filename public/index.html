<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AROI Validator - Automated validation of Authenticated Relay Operator IDs">
    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>AROI Validator - Tor Relay Verification Results</title>
    <style>
        /* 1AEO Brand Design Tokens */
        :root {
            --aeo-green: #00ff7f;
            --aeo-green-dim: #00cc66;
            --aeo-green-hover: #009955;
            --aeo-green-dark: #004d26;
            --aeo-dark-bg: #121212;
            --aeo-dark-surface: #1e1e1e;
            --aeo-dark-border: rgba(0, 255, 127, 0.2);
            --aeo-text: #ffffff;
            --aeo-text-muted: #cccccc;
            --aeo-text-dim: #888888;
            --aeo-dark-hover: #252525;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--aeo-dark-bg);
            color: var(--aeo-text);
            line-height: 1.6;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 2px solid var(--aeo-green);
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--aeo-green);
            font-weight: bold;
        }

        .subtitle {
            color: var(--aeo-green);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .description {
            max-width: 800px;
            margin: 0 auto;
            color: var(--aeo-text-muted);
            font-size: 18px;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--aeo-dark-surface);
            border: 1px solid var(--aeo-green);
            border-radius: 10px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.6);
        }

        .stat-label {
            color: var(--aeo-green);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            color: var(--aeo-text);
            font-size: 2rem;
            font-weight: bold;
        }

        .section {
            background: var(--aeo-dark-surface);
            border: 1px dashed var(--aeo-green);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.3);
        }

        h2 {
            color: var(--aeo-green);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .file-list {
            list-style: none;
            padding: 0;
        }

        .file-item {
            background: var(--aeo-dark-surface);
            border: 1px solid var(--aeo-green);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s, box-shadow 0.2s;
        }

        .file-item:hover {
            background: var(--aeo-dark-hover);
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.4);
        }

        .file-name {
            color: var(--aeo-text);
            font-weight: 500;
        }

        .file-meta {
            color: var(--aeo-text-muted);
            font-size: 0.9rem;
        }

        a {
            color: var(--aeo-green);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            text-decoration: underline;
        }

        .button {
            display: inline-block;
            background-color: var(--aeo-green);
            color: var(--aeo-dark-bg);
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s, transform 0.2s;
            border: none;
            cursor: pointer;
        }

        .button:hover {
            background-color: var(--aeo-green-dim);
            transform: translateY(-2px);
        }

        .info-box {
            background: rgba(0, 255, 127, 0.1);
            border-left: 4px solid var(--aeo-green);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .loading {
            text-align: center;
            color: var(--aeo-text-muted);
            padding: 2rem;
        }
        
        p {
            font-size: 18px;
            color: var(--aeo-text-muted);
        }

        .update-time {
            color: var(--aeo-text-muted);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
        }

        /* 1AEO Cross-Site Navigation Bar */
        .aeo-cross-nav {
            background-color: var(--aeo-dark-surface);
            padding: 10px 0;
            border-bottom: 1px solid var(--aeo-dark-border);
            margin-bottom: 0;
        }
        
        .aeo-cross-nav .aeo-nav-container {
            max-width: 95%;
            margin: 0 auto;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .aeo-cross-nav .aeo-nav-brand {
            color: var(--aeo-green);
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .aeo-cross-nav .aeo-nav-brand:hover {
            color: var(--aeo-green);
            text-decoration: none;
        }
        
        .aeo-cross-nav .aeo-nav-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
        }
        
        .aeo-cross-nav .aeo-nav-links a {
            color: var(--aeo-text-muted);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .aeo-cross-nav .aeo-nav-links a:hover {
            color: var(--aeo-green);
            text-decoration: none;
        }
        
        .aeo-cross-nav .aeo-nav-links a.active {
            color: var(--aeo-green);
            font-weight: 500;
        }
        
        @media (max-width: 480px) {
            .aeo-cross-nav .aeo-nav-container {
                justify-content: center;
                text-align: center;
            }
            .aeo-cross-nav .aeo-nav-links {
                justify-content: center;
                gap: 12px;
            }
        }

        /* 1AEO Footer */
        .aeo-footer {
            background-color: var(--aeo-dark-surface);
            color: var(--aeo-text-muted);
            padding: 25px 20px;
            margin-top: 40px;
            text-align: center;
            border-top: 1px solid var(--aeo-dark-border);
        }
        
        .aeo-footer a {
            color: var(--aeo-green);
            text-decoration: none;
        }
        
        .aeo-footer a:hover {
            color: var(--aeo-green);
            text-decoration: underline;
        }
        
        .aeo-footer-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .aeo-footer-brand {
            font-size: 14px;
            margin: 0;
        }
        
        .aeo-footer-legal {
            font-size: 12px;
            color: var(--aeo-text-dim);
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <nav class="aeo-cross-nav">
        <div class="aeo-nav-container">
            <a href="https://www.1aeo.com" class="aeo-nav-brand">
                <span>1AEO</span>
            </a>
            <div class="aeo-nav-links">
                <a href="https://www.1aeo.com">Home</a>
                <a href="https://metrics.1aeo.com">Metrics</a>
                <a href="https://aroivalidator.1aeo.com" class="active">AROI Validator</a>
                <a href="https://routefluxmap.1aeo.com">RouteFluxMap</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è AROI Validator</h1>
            <p class="subtitle">Authenticated Relay Operator ID Verification</p>
            <p class="description">
                Automated hourly validation of Authenticated Relay Operator IDs (AROIs) from the Tor network. 
                Verifies relay operator identity proofs using DNS-RSA and URI-RSA cryptographic validation methods.
            </p>
        </header>

        <div class="section">
            <h2>üìä Latest Validation Results</h2>
            
            <div class="stats-grid" id="stats" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-label">Total Relays</div>
                    <div class="stat-value" id="total-relays">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Relays with Valid Proofs</div>
                    <div class="stat-value" id="valid-relays">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Relay Proof Success Rate</div>
                    <div class="stat-value" id="success-rate">--%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Last Updated</div>
                    <div class="stat-value" style="font-size: 1rem;" id="last-updated">--</div>
                </div>
            </div>
            
            <p style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="latest.json" class="button" target="_blank">üëÅÔ∏è View JSON</a>
                <a href="latest.json" class="button" download>‚¨áÔ∏è Download JSON</a>
            </p>
            
            <p style="color: var(--aeo-text-dim); font-size: 0.85rem; margin-top: 1.5rem; text-align: center;" id="validation-timestamp">
                Loading timestamp...
            </p>
        </div>

        <div class="section">
            <h2>üìÅ Historical Results Archive</h2>
            <p style="color: var(--aeo-text-muted); margin-bottom: 1rem;">
                Browse all validation results. Each file contains complete metadata, statistics, 
                and detailed validation results for individual relays.
            </p>
            <ul class="file-list" id="file-list">
                <li class="loading">Loading results...</li>
            </ul>
        </div>

        <div class="section">
            <h2>‚ÑπÔ∏è About AROI Validation</h2>
            <p style="color: var(--aeo-text-muted);">
                Authenticated Relay Operator IDs (AROIs) enable Tor relay operators to cryptographically 
                prove ownership of their contact information. This validator automatically checks these 
                proofs to verify relay operator authenticity and build trust in the Tor network.
            </p>
            <p style="color: var(--aeo-text-muted); margin-top: 1rem;">
                <strong>Validation Methods:</strong>
            </p>
            <ul style="color: var(--aeo-text-muted); margin-left: 2rem; margin-top: 0.5rem;">
                <li><strong>dns-rsa:</strong> DNSSEC-signed TXT record verification</li>
                <li><strong>uri-rsa:</strong> URI-based RSA signature validation</li>
            </ul>
            <p style="color: var(--aeo-text-muted); margin-top: 1rem; font-size: 0.9rem;">
                Learn more about the 
                <a href="https://nusenu.github.io/tor-relay-operator-ids-trust-information/" target="_blank" rel="noopener noreferrer">
                    AROI framework and trust methodology
                </a>
            </p>
        </div>
    </div>

    <footer class="aeo-footer">
        <div class="aeo-footer-links">
            <a href="https://metrics.1aeo.com" rel="noopener noreferrer">Metrics</a>
            <a href="https://aroivalidator.1aeo.com" rel="noopener noreferrer">AROI Validator</a>
            <a href="https://routefluxmap.1aeo.com" rel="noopener noreferrer">RouteFluxMap</a>
            <a href="https://github.com/1aeo" rel="noopener noreferrer">GitHub</a>
        </div>
        <p class="aeo-footer-brand">
            Part of <a href="https://www.1aeo.com" style="font-weight: bold;" rel="noopener noreferrer">1st Amendment Encrypted Openness LLC</a>
        </p>
        <p class="aeo-footer-legal">
            Automated validation runs hourly. Data sourced from <a href="https://onionoo.torproject.org/" rel="noopener noreferrer">Tor Project Onionoo</a>. 
            Learn about the <a href="https://nusenu.github.io/tor-relay-operator-ids-trust-information/" rel="noopener noreferrer">AROI methodology</a>.
        </p>
    </footer>

    <script>
        // Load and display latest results
        async function loadLatestResults() {
            try {
                // Add cache-busting parameter to ensure fresh data
                const response = await fetch('latest.json?t=' + Date.now());
                const data = await response.json();
                
                // Update stats
                document.getElementById('total-relays').textContent = 
                    data.metadata?.total_relays || '--';
                document.getElementById('valid-relays').textContent = 
                    data.metadata?.valid_relays || '--';
                
                const successRate = data.metadata?.success_rate || 0;
                document.getElementById('success-rate').textContent = 
                    successRate.toFixed(1) + '%';
                
                const timestamp = data.metadata?.timestamp;
                if (timestamp) {
                    const date = new Date(timestamp);
                    
                    // Show date and time on same line in Last Updated card
                    const shortDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const timeWithZone = date.toLocaleTimeString('en-US', { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        timeZoneName: 'short'
                    });
                    document.getElementById('last-updated').textContent = 
                        shortDate + ' ' + timeWithZone;
                    
                    // Update detailed timestamp at bottom of section
                    document.getElementById('validation-timestamp').textContent = 
                        'Validation completed: ' + date.toLocaleString('en-US', { 
                            dateStyle: 'full', 
                            timeStyle: 'long' 
                        });
                }
            } catch (error) {
                console.error('Error loading latest results:', error);
                document.getElementById('validation-timestamp').textContent = 
                    'Error loading latest results';
            }
        }

        // Pagination state
        let currentPage = 0;
        const filesPerPage = 10;
        let allFiles = [];

        // Load and display all JSON files with pagination
        async function loadFileList() {
            const fileList = document.getElementById('file-list');
            
            try {
                // Fetch file manifest (already sorted newest first)
                const response = await fetch('files.json');
                allFiles = await response.json();
                
                if (!allFiles || allFiles.length === 0) {
                    fileList.innerHTML = `
                        <li class="file-item">
                            <div>
                                <div class="file-name">üìÇ Historical Results</div>
                                <div class="file-meta">Results will appear here after hourly validation runs</div>
                            </div>
                        </li>
                    `;
                    return;
                }
                
                displayPage(0);
            } catch (error) {
                console.error('Error loading file list:', error);
                fileList.innerHTML = `
                    <li class="file-item">
                        <div class="file-name">üìÇ Historical Results</div>
                        <div class="file-meta">Check back after hourly validation runs</div>
                    </div>
                    </li>
                `;
            }
        }

        // Security: Validate filename format and escape for HTML
        const VALID_FILE = /^aroi_validation_(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})\.json$/;
        const VALID_ARCHIVE = /^archives\/aroi-\d{6}\.tar\.gz$/;
        
        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
        }

        // Display a specific page of results
        function displayPage(page) {
            const fileList = document.getElementById('file-list');
            const totalPages = Math.ceil(allFiles.length / filesPerPage);
            page = Math.max(0, Math.min(page | 0, totalPages - 1));  // Clamp to valid range
            currentPage = page;
            
            const pageFiles = allFiles.slice(page * filesPerPage, (page + 1) * filesPerPage);
            
            // Display files
            const html = pageFiles.map(filename => {
                // Security: Validate and parse filename
                const match = VALID_FILE.exec(filename);
                if (!match && !VALID_ARCHIVE.test(filename)) {
                    console.warn('Invalid filename rejected:', filename);
                    return '';
                }
                
                let displayDate = escapeHtml(filename);
                if (match) {
                    const [, y, mo, d, h, mi, s] = match;
                    const dateObj = new Date(`${y}-${mo}-${d}T${h}:${mi}:${s}`);
                    const timePart = dateObj.toLocaleTimeString('en-US', {
                        hour: 'numeric', minute: '2-digit', second: '2-digit', timeZoneName: 'short'
                    });
                    displayDate = escapeHtml(`${y}-${mo}-${d} ${timePart}`);
                }
                
                const safeFilename = encodeURIComponent(filename);
                return `
                    <li class="file-item">
                        <div>
                            <div class="file-name">${displayDate}</div>
                            <div class="file-meta">${escapeHtml(filename)}</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="${safeFilename}" class="button" target="_blank" rel="noopener noreferrer" style="padding: 0.5rem 1rem; font-size: 0.9rem;">üëÅÔ∏è View</a>
                            <a href="${safeFilename}" class="button" download style="padding: 0.5rem 1rem; font-size: 0.9rem;">‚¨áÔ∏è Download</a>
                        </div>
                    </li>`;
            }).join('');
            
            // Pagination controls
            const pagination = totalPages > 1 ? `
                <li class="file-item" style="margin-top: 1rem; border: 1px solid var(--aeo-green); justify-content: center;">
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button class="button" ${page === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;' : 'style="'}padding: 0.5rem 1rem; font-size: 0.9rem;"
                                onclick="displayPage(${page - 1})">‚Üê Previous</button>
                        <span style="color: var(--aeo-green);">Page ${page + 1} of ${totalPages} (${allFiles.length} total)</span>
                        <button class="button" ${page === totalPages - 1 ? 'disabled style="opacity: 0.5; cursor: not-allowed;' : 'style="'}padding: 0.5rem 1rem; font-size: 0.9rem;"
                                onclick="displayPage(${page + 1})">Next ‚Üí</button>
                    </div>
                </li>` : '';
            
            fileList.innerHTML = html + pagination;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadLatestResults();
            loadFileList();
            
            // Refresh stats every 60 seconds
            setInterval(loadLatestResults, 60000);
        });
    </script>
</body>
</html>
